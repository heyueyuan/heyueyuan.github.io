<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>操作MongoDB | Mark He</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.9854472c.css" as="style"><link rel="preload" href="/assets/js/app.265cfc62.js" as="script"><link rel="preload" href="/assets/js/37.1b798d69.js" as="script"><link rel="prefetch" href="/assets/js/10.aeb08d6d.js"><link rel="prefetch" href="/assets/js/11.c47163b6.js"><link rel="prefetch" href="/assets/js/12.915cb852.js"><link rel="prefetch" href="/assets/js/13.eff9359d.js"><link rel="prefetch" href="/assets/js/14.a7c6041b.js"><link rel="prefetch" href="/assets/js/15.d636104a.js"><link rel="prefetch" href="/assets/js/16.5692cdd2.js"><link rel="prefetch" href="/assets/js/17.69126d01.js"><link rel="prefetch" href="/assets/js/18.6eeb36a9.js"><link rel="prefetch" href="/assets/js/19.58fca24d.js"><link rel="prefetch" href="/assets/js/2.6ce74938.js"><link rel="prefetch" href="/assets/js/20.25d4abb7.js"><link rel="prefetch" href="/assets/js/21.60fbe128.js"><link rel="prefetch" href="/assets/js/22.1c918ce7.js"><link rel="prefetch" href="/assets/js/23.67e27de0.js"><link rel="prefetch" href="/assets/js/24.22e1499d.js"><link rel="prefetch" href="/assets/js/25.02c31893.js"><link rel="prefetch" href="/assets/js/26.ec379253.js"><link rel="prefetch" href="/assets/js/27.df1dfb7c.js"><link rel="prefetch" href="/assets/js/28.e5f55e62.js"><link rel="prefetch" href="/assets/js/29.4ab53bc8.js"><link rel="prefetch" href="/assets/js/3.89d1e693.js"><link rel="prefetch" href="/assets/js/30.13a47086.js"><link rel="prefetch" href="/assets/js/31.3e08bbf0.js"><link rel="prefetch" href="/assets/js/32.49e8d2f1.js"><link rel="prefetch" href="/assets/js/33.34b0a6b7.js"><link rel="prefetch" href="/assets/js/34.6c1ac4bc.js"><link rel="prefetch" href="/assets/js/35.521abc2d.js"><link rel="prefetch" href="/assets/js/36.c1ba9b6b.js"><link rel="prefetch" href="/assets/js/38.9409643a.js"><link rel="prefetch" href="/assets/js/39.8178cfd3.js"><link rel="prefetch" href="/assets/js/4.93bfe19f.js"><link rel="prefetch" href="/assets/js/40.72bda93a.js"><link rel="prefetch" href="/assets/js/41.0a2d9067.js"><link rel="prefetch" href="/assets/js/42.1e3cfe94.js"><link rel="prefetch" href="/assets/js/43.2a8a6955.js"><link rel="prefetch" href="/assets/js/44.f0df4491.js"><link rel="prefetch" href="/assets/js/45.0ec4ef64.js"><link rel="prefetch" href="/assets/js/46.d8ab0cfb.js"><link rel="prefetch" href="/assets/js/47.101b564b.js"><link rel="prefetch" href="/assets/js/48.10290b31.js"><link rel="prefetch" href="/assets/js/49.6f0c6b8b.js"><link rel="prefetch" href="/assets/js/5.7c652252.js"><link rel="prefetch" href="/assets/js/50.48ff2154.js"><link rel="prefetch" href="/assets/js/51.8c372db5.js"><link rel="prefetch" href="/assets/js/52.1188b68c.js"><link rel="prefetch" href="/assets/js/53.a04fdb75.js"><link rel="prefetch" href="/assets/js/54.66b64b21.js"><link rel="prefetch" href="/assets/js/55.923fa6e5.js"><link rel="prefetch" href="/assets/js/56.f51a4e44.js"><link rel="prefetch" href="/assets/js/57.ee90ffbd.js"><link rel="prefetch" href="/assets/js/58.a0fb6737.js"><link rel="prefetch" href="/assets/js/59.5581418f.js"><link rel="prefetch" href="/assets/js/6.397be193.js"><link rel="prefetch" href="/assets/js/60.cba6de65.js"><link rel="prefetch" href="/assets/js/61.6046c511.js"><link rel="prefetch" href="/assets/js/62.9dce1a90.js"><link rel="prefetch" href="/assets/js/63.d8a483b0.js"><link rel="prefetch" href="/assets/js/7.f883906b.js"><link rel="prefetch" href="/assets/js/8.e9363c12.js"><link rel="prefetch" href="/assets/js/9.e10c76be.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9854472c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Mark He</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/articles/datascience/" class="nav-link">Data Science</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Development</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Full-Stack</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/articles/development/python/" class="nav-link router-link-active">Python</a></li><li class="dropdown-subitem"><a href="/articles/development/java/" class="nav-link">Java</a></li><li class="dropdown-subitem"><a href="/articles/development/vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/articles/development/Git/" class="nav-link">Git</a></li><li class="dropdown-subitem"><a href="/articles/development/tool/" class="nav-link">Tools</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/articles/algorithm/" class="nav-link">Algorithm</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Network</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/articles/network/R_S/" class="nav-link">Router&amp;Switch</a></li><li class="dropdown-item"><!----> <a href="/articles/network/malfunction/" class="nav-link">Malfunction</a></li></ul></div></div><div class="nav-item"><a href="/articles/speech/" class="nav-link">Speech</a></div><div class="nav-item"><a href="/articles/goals.html" class="nav-link">Goals</a></div><div class="nav-item"><a href="/articles/prepforjob.html" class="nav-link">PrepForJobs</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/articles/datascience/" class="nav-link">Data Science</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Development</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Full-Stack</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/articles/development/python/" class="nav-link router-link-active">Python</a></li><li class="dropdown-subitem"><a href="/articles/development/java/" class="nav-link">Java</a></li><li class="dropdown-subitem"><a href="/articles/development/vue/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/articles/development/Git/" class="nav-link">Git</a></li><li class="dropdown-subitem"><a href="/articles/development/tool/" class="nav-link">Tools</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/articles/algorithm/" class="nav-link">Algorithm</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Network</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/articles/network/R_S/" class="nav-link">Router&amp;Switch</a></li><li class="dropdown-item"><!----> <a href="/articles/network/malfunction/" class="nav-link">Malfunction</a></li></ul></div></div><div class="nav-item"><a href="/articles/speech/" class="nav-link">Speech</a></div><div class="nav-item"><a href="/articles/goals.html" class="nav-link">Goals</a></div><div class="nav-item"><a href="/articles/prepforjob.html" class="nav-link">PrepForJobs</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Basic</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Algorithm</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>SQL</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/articles/development/python/MongoDB.html" class="active sidebar-link">操作MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_1-准备工作" class="sidebar-link">1. 准备工作</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_2-连接mongodb" class="sidebar-link">2. 连接MongoDB</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_3-指定数据库" class="sidebar-link">3. 指定数据库</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_4-指定集合" class="sidebar-link">4. 指定集合</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_5-插入数据" class="sidebar-link">5. 插入数据</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_6-查询" class="sidebar-link">6. 查询</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_7-计数" class="sidebar-link">7. 计数</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_8-排序" class="sidebar-link">8. 排序</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_9-偏移" class="sidebar-link">9. 偏移</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_10-更新" class="sidebar-link">10. 更新</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_11-删除" class="sidebar-link">11. 删除</a></li><li class="sidebar-sub-header"><a href="/articles/development/python/MongoDB.html#_12-其他操作" class="sidebar-link">12. 其他操作</a></li></ul></li><li><a href="/articles/development/python/MySQL.html" class="sidebar-link">操作MySQL</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Web</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Resource</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="操作mongodb">操作MongoDB</h1> <p><a href="https://cloud.tencent.com/product/mongodb?from=10680" target="_blank" rel="noopener noreferrer">MongoDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是由C++语言编写的非<a href="https://cloud.tencent.com/product/cdb-overview?from=10680" target="_blank" rel="noopener noreferrer">关系型数据库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，是一个基于分布式<a href="https://cloud.tencent.com/product/cfs?from=10680" target="_blank" rel="noopener noreferrer">文件存储<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的开源数据库系统，其内容存储形式类似JSON对象，它的字段值可以包含其他文档、数组及文档数组，非常灵活。在这一节中，我们就来看看Python 3下MongoDB的存储操作。</p> <h2 id="_1-准备工作">1. 准备工作</h2> <p>在开始之前，请确保已经安装好了MongoDB并启动了其服务，并且安装好了Python的PyMongo库。</p> <h3 id="_1-1-安装">1.1 安装</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>brew tap mongodb/brew
brew <span class="token function">install</span> mongodb-community@4.2
brew services start mongodb-community@4.2
mongod --config /usr/local/etc/mongod.conf --fork <span class="token comment">##/usr/local/etc/mongod.conf</span>
<span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> -v <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">grep</span> mongod
mongo
</code></pre></div><h3 id="_1-2-配置">1.2 配置</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#数据库路径</span>
dbpath<span class="token operator">=</span>/mongoData/db/
 
<span class="token comment">#日志输出文件路径</span>
logpath<span class="token operator">=</span>/mongoData/logs/mongo.log
 
<span class="token comment">#错误日志采用追加模式，配置这个选项后mongodb的日志会追加到现有的日志文件，而不是从新创建一个新文件</span>
logappend<span class="token operator">=</span>true
 
<span class="token comment">#启用日志文件，默认启用</span>
journal<span class="token operator">=</span>true
 
<span class="token comment">#这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false</span>
quiet<span class="token operator">=</span>false
 
<span class="token comment">#是否后台启动，有这个参数，就可以实现后台运行</span>
fork<span class="token operator">=</span>true
 
<span class="token comment">#端口号 默认为27017</span>
port<span class="token operator">=</span>27017
 
<span class="token comment">#指定存储引擎（默认不需要指定）</span>
<span class="token comment">#storageEngine=mmapv1</span>
 
<span class="token comment">#开启认证</span>
auth <span class="token operator">=</span> <span class="token boolean">true</span>
</code></pre></div><h3 id="_1-3-用户">1.3 用户</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># admin</span>
use admin
show dbs
use admin
db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user:<span class="token string">&quot;admin&quot;</span>,pwd:<span class="token string">&quot;password&quot;</span>,roles:<span class="token punctuation">[</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span> //admin这个数据库是系统自带的数据库，他的用户可以访问任何其他数据库的数据，也叫做超级管理员
db.auth<span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span>,<span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span> // <span class="token operator">=</span><span class="token operator">&gt;</span> 1 表示验证通过 0表示验证失败
show dbs //<span class="token operator">=</span><span class="token operator">&gt;</span>admin 0.000GB blog 0.000GB config 0.000GB
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># users</span>
use admin //<span class="token operator">=</span><span class="token operator">&gt;</span>进入admin数据库
db.auth<span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span>,<span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span> //<span class="token operator">=</span><span class="token operator">&gt;</span> 通过超级管理员验证
use blog
db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user: <span class="token string">&quot;blog&quot;</span>, pwd: <span class="token string">&quot;password&quot;</span>, roles: <span class="token punctuation">[</span><span class="token punctuation">{</span> role: <span class="token string">&quot;dbOwner&quot;</span>, db: <span class="token string">&quot;blog&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
show dbs <span class="token operator">=</span><span class="token operator">&gt;</span> admin 0.000GB blog 0.000GB config 0.000GB local 0.000GB
</code></pre></div><h2 id="_2-连接mongodb">2. 连接MongoDB</h2> <p>连接MongoDB时，我们需要使用PyMongo库里面的<code>MongoClient</code>。一般来说，传入MongoDB的IP及端口即可，其中第一个参数为地址<code>host</code>，第二个参数为端口<code>port</code>（如果不给它传递参数，默认是27017）：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> pymongo
client <span class="token operator">=</span> pymongo<span class="token punctuation">.</span><span class="token function">MongoClient</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">27017</span><span class="token punctuation">)</span>
</code></pre></div><p>这样就可以创建MongoDB的连接对象了。</p> <p>另外，<code>MongoClient</code>的第一个参数<code>host</code>还可以直接传入MongoDB的连接字符串，它以<code>mongodb</code>开头，例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>client <span class="token operator">=</span> <span class="token function">MongoClient</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/'</span><span class="token punctuation">)</span>
</code></pre></div><p>这也可以达到同样的连接效果。</p> <h2 id="_3-指定数据库">3. 指定数据库</h2> <p>MongoDB中可以建立多个数据库，接下来我们需要指定操作哪个数据库。这里我们以test数据库为例来说明，下一步需要在程序中指定要使用的数据库：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db <span class="token operator">=</span> client<span class="token punctuation">.</span>test
</code></pre></div><p>这里调用<code>client</code>的<code>test</code>属性即可返回test数据库。当然，我们也可以这样指定：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db <span class="token operator">=</span> client<span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">]</span>
</code></pre></div><p>这两种方式是等价的。</p> <h2 id="_4-指定集合">4. 指定集合</h2> <p>MongoDB的每个数据库又包含许多集合（collection），它们类似于关系型数据库中的表。</p> <p>下一步需要指定要操作的集合，这里指定一个集合名称为students。与指定数据库类似，指定集合也有两种方式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>collection <span class="token operator">=</span> db<span class="token punctuation">.</span>students
collection <span class="token operator">=</span> db<span class="token punctuation">[</span><span class="token string">'students'</span><span class="token punctuation">]</span>
</code></pre></div><p>这样我们便声明了一个<code>Collection</code>对象。</p> <h2 id="_5-插入数据">5. 插入数据</h2> <p>接下来，便可以插入数据了。对于students这个集合，新建一条学生数据，这条数据以字典形式表示：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>student <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170101'</span><span class="token punctuation">,</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Jordan'</span><span class="token punctuation">,</span>
    <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里指定了学生的学号、姓名、年龄和性别。接下来，直接调用<code>collection</code>的<code>insert()</code>方法即可插入数据，代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><p>在MongoDB中，每条数据其实都有一个<code>_id</code>属性来唯一标识。如果没有显式指明该属性，MongoDB会自动产生一个<code>ObjectId</code>类型的<code>_id</code>属性。<code>insert()</code>方法会在执行后返回<code>_id</code>值。</p> <p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">5932</span>a68615c2606814c91f3d
</code></pre></div><p>当然，我们也可以同时插入多条数据，只需要以列表形式传递即可，示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>student1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170101'</span><span class="token punctuation">,</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Jordan'</span><span class="token punctuation">,</span>
    <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span>
<span class="token punctuation">}</span>

student2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170202'</span><span class="token punctuation">,</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Mike'</span><span class="token punctuation">,</span>
    <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
    <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span>
<span class="token punctuation">}</span>

result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>student1<span class="token punctuation">,</span> student2<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><p>返回结果是对应的<code>_id</code>的集合：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'5932a80115c2606a59e8a048'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'5932a80115c2606a59e8a049'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><p>实际上，在PyMongo 3.x版本中，官方已经不推荐使用<code>insert()</code>方法了。当然，继续使用也没有什么问题。官方推荐使用<code>insert_one()</code>和<code>insert_many()</code>方法来分别插入单条记录和多条记录，示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>student <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170101'</span><span class="token punctuation">,</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Jordan'</span><span class="token punctuation">,</span>
    <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span>
<span class="token punctuation">}</span>

result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">insert_one</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>inserted_id<span class="token punctuation">)</span>
</code></pre></div><p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>pymongo<span class="token punctuation">.</span>results<span class="token punctuation">.</span>InsertOneResult object at <span class="token number">0x10d68b558</span><span class="token operator">&gt;</span>
<span class="token number">5932</span>ab0f15c2606f0c1cf6c5
</code></pre></div><p>与<code>insert()</code>方法不同，这次返回的是<code>InsertOneResult</code>对象，我们可以调用其<code>inserted_id</code>属性获取<code>_id</code>。</p> <p>对于<code>insert_many()</code>方法，我们可以将数据以列表形式传递，示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>student1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170101'</span><span class="token punctuation">,</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Jordan'</span><span class="token punctuation">,</span>
    <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span>
<span class="token punctuation">}</span>

student2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170202'</span><span class="token punctuation">,</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Mike'</span><span class="token punctuation">,</span>
    <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
    <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span>
<span class="token punctuation">}</span>

result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">insert_many</span><span class="token punctuation">(</span><span class="token punctuation">[</span>student1<span class="token punctuation">,</span> student2<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>inserted_ids<span class="token punctuation">)</span>
</code></pre></div><p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>pymongo<span class="token punctuation">.</span>results<span class="token punctuation">.</span>InsertManyResult object at <span class="token number">0x101dea558</span><span class="token operator">&gt;</span>
<span class="token punctuation">[</span><span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'5932abf415c2607083d3b2ac'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'5932abf415c2607083d3b2ad'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><p>该方法返回的类型是<code>InsertManyResult</code>，调用<code>inserted_ids</code>属性可以获取插入数据的<code>_id</code>列表。</p> <h2 id="_6-查询">6. 查询</h2> <p>插入数据后，我们可以利用<code>find_one()</code>或<code>find()</code>方法进行查询，其中<code>find_one()</code>查询得到的是单个结果，<code>find()</code>则返回一个生成器对象。示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find_one</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Mike'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><p>这里我们查询<code>name</code>为<code>Mike</code>的数据，它的返回结果是字典类型，运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict'</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'5932a80115c2606a59e8a049'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170202'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">}</span>
</code></pre></div><p>可以发现，它多了<code>_id</code>属性，这就是MongoDB在插入过程中自动添加的。</p> <p>此外，我们也可以根据<code>ObjectId</code>来查询，此时需要使用bson库里面的<code>objectid</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">from</span> bson<span class="token punctuation">.</span>objectid <span class="token keyword">import</span> ObjectId

result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find_one</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'593278c115c2602667ec6bae'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><p>其查询结果依然是字典类型，具体如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'593278c115c2602667ec6bae'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170101'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Jordan'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">}</span>
</code></pre></div><p>当然，如果查询结果不存在，则会返回<code>None</code>。</p> <p>对于多条数据的查询，我们可以使用<code>find()</code>方法。例如，这里查找年龄为20的数据，示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>results <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
<span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>pymongo<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>Cursor object at <span class="token number">0x1032d5128</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'593278c115c2602667ec6bae'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170101'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Jordan'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'593278c815c2602678bb2b8d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170102'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Kevin'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'593278d815c260269d7645a8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'20170103'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Harden'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">:</span> <span class="token string">'male'</span><span class="token punctuation">}</span>
</code></pre></div><p>返回结果是<code>Cursor</code>类型，它相当于一个生成器，我们需要遍历取到所有的结果，其中每个结果都是字典类型。</p> <p>如果要查询年龄大于20的数据，则写法如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>results <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'$gt'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这里查询的条件键值已经不是单纯的数字了，而是一个字典，其键名为比较符号<code>$gt</code>，意思是大于，键值为20。</p> <p>这里将比较符号归纳为下表。</p> <table><thead><tr><th style="text-align:left">符号</th> <th style="text-align:left">含义</th> <th style="text-align:left">示例</th></tr></thead> <tbody><tr><td style="text-align:left">$lt</td> <td style="text-align:left">小于</td> <td style="text-align:left">{'age': {'$lt': 20}}</td></tr> <tr><td style="text-align:left">$gt</td> <td style="text-align:left">大于</td> <td style="text-align:left">{'age': {'$gt': 20}}</td></tr> <tr><td style="text-align:left">$lte</td> <td style="text-align:left">小于等于</td> <td style="text-align:left">{'age': {'$lte': 20}}</td></tr> <tr><td style="text-align:left">$gte</td> <td style="text-align:left">大于等于</td> <td style="text-align:left">{'age': {'$gte': 20}}</td></tr> <tr><td style="text-align:left">$ne</td> <td style="text-align:left">不等于</td> <td style="text-align:left">{'age': {'$ne': 20}}</td></tr> <tr><td style="text-align:left">$in</td> <td style="text-align:left">在范围内</td> <td style="text-align:left">{'age': {'$in': [20, 23]}}</td></tr> <tr><td style="text-align:left">$nin</td> <td style="text-align:left">不在范围内</td> <td style="text-align:left">{'age': {'$nin': [20, 23]}}</td></tr></tbody></table> <p>另外，还可以进行正则匹配查询。例如，查询名字以M开头的学生数据，示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>results <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'$regex'</span><span class="token punctuation">:</span> <span class="token string">'^M.*'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这里使用<code>$regex</code>来指定正则匹配，<code>^M.*</code>代表以M开头的正则表达式。</p> <p>这里将一些功能符号再归类为下表。</p> <table><thead><tr><th style="text-align:left">符号</th> <th style="text-align:left">含义</th> <th style="text-align:left">示例</th> <th style="text-align:left">示例含义</th></tr></thead> <tbody><tr><td style="text-align:left">$regex</td> <td style="text-align:left">匹配正则表达式</td> <td style="text-align:left">{'name': {'$regex': '^M.*'}}</td> <td style="text-align:left">name以M开头</td></tr> <tr><td style="text-align:left">$exists</td> <td style="text-align:left">属性是否存在</td> <td style="text-align:left">{'name': {'$exists': True}}</td> <td style="text-align:left">name属性存在</td></tr> <tr><td style="text-align:left">$type</td> <td style="text-align:left">类型判断</td> <td style="text-align:left">{'age': {'$type': 'int'}}</td> <td style="text-align:left">age的类型为int</td></tr> <tr><td style="text-align:left">$mod</td> <td style="text-align:left">数字模操作</td> <td style="text-align:left">{'age': {'$mod': [5, 0]}}</td> <td style="text-align:left">年龄模5余0</td></tr> <tr><td style="text-align:left">$text</td> <td style="text-align:left">文本查询</td> <td style="text-align:left">{'$text': {'$search': 'Mike'}}</td> <td style="text-align:left">text类型的属性中包含Mike字符串</td></tr> <tr><td style="text-align:left">$where</td> <td style="text-align:left">高级条件查询</td> <td style="text-align:left">{'$where': 'obj.fans_count == obj.follows_count'}</td> <td style="text-align:left">自身粉丝数等于关注数</td></tr></tbody></table> <p>关于这些操作的更详细用法，可以在MongoDB官方文档找到： https://docs.mongodb.com/manual/reference/operator/query/。</p> <h2 id="_7-计数">7. 计数</h2> <p>要统计查询结果有多少条数据，可以调用<code>count()</code>方法。比如，统计所有数据条数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>count <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
</code></pre></div><p>或者统计符合某个条件的数据：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>count <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
</code></pre></div><p>运行结果是一个数值，即符合条件的数据条数。</p> <h2 id="_8-排序">8. 排序</h2> <p>排序时，直接调用<code>sort()</code>方法，并在其中传入排序的字段及升降序标志即可。示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>results <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> pymongo<span class="token punctuation">.</span><span class="token constant">ASCENDING</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>result<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token string">'Harden'</span><span class="token punctuation">,</span> <span class="token string">'Jordan'</span><span class="token punctuation">,</span> <span class="token string">'Kevin'</span><span class="token punctuation">,</span> <span class="token string">'Mark'</span><span class="token punctuation">,</span> <span class="token string">'Mike'</span><span class="token punctuation">]</span>
</code></pre></div><p>这里我们调用<code>pymongo.ASCENDING</code>指定升序。如果要降序排列，可以传入<code>pymongo.DESCENDING</code>。</p> <h2 id="_9-偏移">9. 偏移</h2> <p>在某些情况下，我们可能想只取某几个元素，这时可以利用<code>skip()</code>方法偏移几个位置，比如偏移2，就忽略前两个元素，得到第三个及以后的元素：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>results <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> pymongo<span class="token punctuation">.</span><span class="token constant">ASCENDING</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>result<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token string">'Kevin'</span><span class="token punctuation">,</span> <span class="token string">'Mark'</span><span class="token punctuation">,</span> <span class="token string">'Mike'</span><span class="token punctuation">]</span>
</code></pre></div><p>另外，还可以用<code>limit()</code>方法指定要取的结果个数，示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>results <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> pymongo<span class="token punctuation">.</span><span class="token constant">ASCENDING</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>result<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token string">'Kevin'</span><span class="token punctuation">,</span> <span class="token string">'Mark'</span><span class="token punctuation">]</span>
</code></pre></div><p>如果不使用<code>limit()</code>方法，原本会返回三个结果，加了限制后，会截取两个结果返回。</p> <p>值得注意的是，在数据库数量非常庞大的时候，如千万、亿级别，最好不要使用大的偏移量来查询数据，因为这样很可能导致内存溢出。此时可以使用类似如下操作来查询：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">from</span> bson<span class="token punctuation">.</span>objectid <span class="token keyword">import</span> ObjectId
collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'_id'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'$gt'</span><span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">'593278c815c2602678bb2b8d'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这时需要记录好上次查询的<code>_id</code>。</p> <h2 id="_10-更新">10. 更新</h2> <p>对于数据更新，我们可以使用<code>update()</code>方法，指定更新的条件和更新后的数据即可。例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>condition <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Kevin'</span><span class="token punctuation">}</span>
student <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find_one</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span>
student<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">25</span>
result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>condition<span class="token punctuation">,</span> student<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><p>这里我们要更新<code>name</code>为<code>Kevin</code>的数据的年龄：首先指定查询条件，然后将数据查询出来，修改年龄后调用<code>update()</code>方法将原条件和修改后的数据传入。</p> <p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span><span class="token string">'ok'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'nModified'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'updatedExisting'</span><span class="token punctuation">:</span> True<span class="token punctuation">}</span>
</code></pre></div><p>返回结果是字典形式，<code>ok</code>代表执行成功，<code>nModified</code>代表影响的数据条数。</p> <p>另外，我们也可以使用<code>$set</code>操作符对数据进行更新，代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>condition<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'$set'</span><span class="token punctuation">:</span> student<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这样可以只更新<code>student</code>字典内存在的字段。如果原先还有其他字段，则不会更新，也不会删除。而如果不用<code>$set</code>的话，则会把之前的数据全部用<code>student</code>字典替换；如果原本存在其他字段，则会被删除。</p> <p>另外，<code>update()</code>方法其实也是官方不推荐使用的方法。这里也分为<code>update_one()</code>方法和<code>update_many()</code>方法，用法更加严格，它们的第二个参数需要使用<code>$</code>类型操作符作为字典的键名，示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>condition <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Kevin'</span><span class="token punctuation">}</span>
student <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">find_one</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span>
student<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">26</span>
result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">update_one</span><span class="token punctuation">(</span>condition<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'$set'</span><span class="token punctuation">:</span> student<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>matched_count<span class="token punctuation">,</span> result<span class="token punctuation">.</span>modified_count<span class="token punctuation">)</span>
</code></pre></div><p>这里调用了<code>update_one()</code>方法，第二个参数不能再直接传入修改后的字典，而是需要使用<code>{'$set': student}</code>这样的形式，其返回结果是<code>UpdateResult</code>类型。然后分别调用<code>matched_count</code>和<code>modified_count</code>属性，可以获得匹配的数据条数和影响的数据条数。</p> <p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>pymongo<span class="token punctuation">.</span>results<span class="token punctuation">.</span>UpdateResult object at <span class="token number">0x10d17b678</span><span class="token operator">&gt;</span>
<span class="token number">1</span> <span class="token number">0</span>
</code></pre></div><p>我们再看一个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>condition <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'$gt'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">update_one</span><span class="token punctuation">(</span>condition<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'$inc'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>matched_count<span class="token punctuation">,</span> result<span class="token punctuation">.</span>modified_count<span class="token punctuation">)</span>
</code></pre></div><p>这里指定查询条件为年龄大于20，然后更新条件为<code>{'$inc': {'age': 1}}</code>，也就是年龄加1，执行之后会将第一条符合条件的数据年龄加1。</p> <p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>pymongo<span class="token punctuation">.</span>results<span class="token punctuation">.</span>UpdateResult object at <span class="token number">0x10b8874c8</span><span class="token operator">&gt;</span>
<span class="token number">1</span> <span class="token number">1</span>
</code></pre></div><p>可以看到匹配条数为1条，影响条数也为1条。</p> <p>如果调用<code>update_many()</code>方法，则会将所有符合条件的数据都更新，示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>condition <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'$gt'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">update_many</span><span class="token punctuation">(</span>condition<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'$inc'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>matched_count<span class="token punctuation">,</span> result<span class="token punctuation">.</span>modified_count<span class="token punctuation">)</span>
</code></pre></div><p>这时匹配条数就不再为1条了，运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>pymongo<span class="token punctuation">.</span>results<span class="token punctuation">.</span>UpdateResult object at <span class="token number">0x10c6384c8</span><span class="token operator">&gt;</span>
<span class="token number">3</span> <span class="token number">3</span>
</code></pre></div><p>可以看到，这时所有匹配到的数据都会被更新。</p> <h2 id="_11-删除">11. 删除</h2> <p>删除操作比较简单，直接调用<code>remove()</code>方法指定删除的条件即可，此时符合条件的所有数据均会被删除。示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Kevin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span><span class="token string">'ok'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
</code></pre></div><p>另外，这里依然存在两个新的推荐方法——<code>delete_one()</code>和<code>delete_many()</code>。示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">delete_one</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Kevin'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>deleted_count<span class="token punctuation">)</span>
result <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">delete_many</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'$lt'</span><span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>deleted_count<span class="token punctuation">)</span>
</code></pre></div><p>运行结果如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>pymongo<span class="token punctuation">.</span>results<span class="token punctuation">.</span>DeleteResult object at <span class="token number">0x10e6ba4c8</span><span class="token operator">&gt;</span>
<span class="token number">1</span>
<span class="token number">4</span>
</code></pre></div><p><code>delete_one()</code>即删除第一条符合条件的数据，<code>delete_many()</code>即删除所有符合条件的数据。它们的返回结果都是<code>DeleteResult</code>类型，可以调用<code>deleted_count</code>属性获取删除的数据条数。</p> <h2 id="_12-其他操作">12. 其他操作</h2> <p>另外，PyMongo还提供了一些组合方法，如<code>find_one_and_delete()</code>、<code>find_one_and_replace()</code>和<code>find_one_and_update()</code>，它们是查找后删除、替换和更新操作，其用法与上述方法基本一致。</p> <p>另外，还可以对索引进行操作，相关方法有<code>create_index()</code>、<code>create_indexes()</code>和<code>drop_index()</code>等。</p> <p>关于PyMongo的详细用法，可以参见官方文档：http://api.mongodb.com/python/current/api/pymongo/collection.html。</p> <p>另外，还有对数据库和集合本身等的一些操作，这里不再一一讲解，可以参见官方文档：http://api.mongodb.com/python/current/api/pymongo/。</p> <p>本节讲解了使用PyMongo操作MongoDB进行数据增删改查的方法。</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/articles/development/python/algorithm.html" class="prev">
          算法
        </a></span> <span class="next"><a href="/articles/development/python/MySQL.html">
          操作MySQL
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.265cfc62.js" defer></script><script src="/assets/js/37.1b798d69.js" defer></script>
  </body>
</html>
